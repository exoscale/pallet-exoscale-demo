<!doctype html>
<html ng-app="main">
  <head>
    <meta charset="utf-8">
    
    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    
    <title>Exoscale Deployer</title>
    
    <link href="/css/bootstrap.css" media="screen"
	  rel="stylesheet" type="text/css" />
    <link href="/css/bootstrap-responsive.css" media="screen"
	  rel="stylesheet" type="text/css" />
    <link href="/css/font-awesome.css" media="screen"
	  rel="stylesheet" type="text/css" />
  </head>

  <body ng-controller="DeployerCtrl">
    <div class="navbar navbar-inverse">
      <div class="navbar-inner">
	<div class="container-fluid">
	  <a class="brand" href="/index.html">exoscale deployer</a>
	</div>
      </div>
    </div>

    <div modal="show_converge_output">
      <div class="modal-header">
	<h3>Converge Output</h3>
      </div>

      <div class="modal-body">
	<p class="alert alert-error" ng-show="!converge_output.success">
	  Some errors occured while provisioning configuration
	</p>

	<p class="alert alert-info" ng-show="converge_output.success">
	  Configuration successfully deployed
	</p>

	<div ng-repeat="phase in converge_output.phases">
	  Phase {{phase.phase}}
	  
	  <div class="well">
	    <pre ng-repeat="results in phase.details.results">
	      {{results.out}}
	    </pre>
	  </div>
	</div>
      </div>

      <div class="modal-footer">
	<button class="btn btn-primary" ng-click="close_modal()">dismiss</button>
      </div>

    </div>

    <div class="container-fluid">
      <div class="row-fluid">
	<div class="span10 offset1">

	  <div class="container-fluid">
	    <div class="row-fluid">

	      <div class="span6">
		<h3>Topologies</h3>
		<div ng-repeat="(name,config) in topologies">
		  <h4>{{name}}</h4>
		  <table class="table table-bordered table-striped">
		    <tr ng-repeat="(groupname,groupconfig) in config">
		      <td>
			{{groupname}}
		      </td>
		      <td>
			<span ng-repeat="role in groupconfig.roles" class="">{{role}}&nbsp;</span>
		      </td>
		      <td>
			<input class="input-mini" type="text" ng-model="groupconfig.size">
		      </td>
		    </tr>
		  </table>
		</div>
	      </div>

	      <div class="span6">
		<h3>Services</h3>
		<table class="table table-bordered table-striped">
		  <thead>
		    <tr>
		      <th>name</th>
		      <th>actions</th>
		      <th>details</th>
		    </tr>
		  </thead>
		  <tbody>
		    <tr ng-repeat="(service,config) in services">
		      <td>{{service}}</td>
		      <td>
			<button class="btn btn-primary"
				ng-click="converge(service, 1, 'install')">
			  <i class="icon-rocket"></i> install
			</button>
		      </td>
		      <td>
			<small>{{config.nodecount}} nodes up</small>
		      </td>
		    </tr>
		  </tbody>
		</table>
	      </div>
	    </div>
	  </div>
	</div>
      </div>

    </div>

    <script src="/js/vendor/jquery.js" type="text/javascript"></script>
    <script src="/js/vendor/underscore.js" type="text/javascript"></script>
    <script src="/js/vendor/bootstrap.js" type="text/javascript"></script>
    <script src="/js/vendor/angular.js" type="text/javascript"></script>
    <script src="/js/vendor/ui-bootstrap.js" type="text/javascript"></script>
    <script src="/js/deployer.js" type="text/javascript"></script>
  </body>
</html>
